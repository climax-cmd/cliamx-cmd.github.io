<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>焼きなまし法のマルコフ連鎖モデル - climaxのホームページ</title>
    <link rel="stylesheet" href="css/style.css">
    
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']]
          }
        };
    </script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    </head>
<body>
    <header>
        <h1>climaxのホームページ</h1>
    </header>

    <main class="article-content">
        <article>
            <h2>焼きなまし法のマルコフ連鎖モデル</h2>

            <h3>焼きなまし法の紹介</h3>
            <ul>
                <li>常に良い解を選ぶのではなく、「温度」パラメータに応じて確率的に悪い解も許容します。</li>
                <li>一般に離散的に状態空間を持つ組み合わせ最適化問題に対してのアプローチです。</li>
                <li>最初に温度を設定し、徐々に冷やしていきます。</li>
                <li><strong>探索初期(高温):</strong> 解が悪化する移動も許容し、広域的に探索します。</li>
                <li><strong>探索終盤(低温):</strong> 次第に改善する移動のみを選択し、一つの解に収束させます。</li>
                <li>この方法はマルコフ過程によってモデリングでき大域的最適解が保証できます！(一般にヒューリスティック解法は解の保証がないものが多いです)。</li>
            </ul>

            <h3>準備(マルコフ連鎖とは)</h3>
            <ul>
                <li>マルコフ過程のうち、状態が離散的(有限的)なものをマルコフ連鎖と呼びます。</li>
                <li>オートマトンと非常に似た構造を持っています。</li>
                <li>違いは遷移が確率によって起こるか、外部入力される文字によって起こるかです。</li>
            </ul>

            <h3>マルコフ連鎖の分類</h3>
            <h4>斉時性と既約性</h4>
            <ul>
                <li><strong>斉時性:</strong> 状態の推移確率が時間に拠らず一定です (焼きなまし法では実際の推移する確率でないことに注意)。</li>
                <li><strong>既約性:</strong> マルコフ連鎖の状態空間の任意の二状態が互いに到達可能です。</li>
                <li>状態が互いに到達可能かは同値関係を満たし、状態集合はこの同値関係を使って直和分解できます。</li>
            </ul>
            <h4>非周期性</h4>
            <ul>
                <li><strong>非周期性:</strong> n回のステップで頂点iからjに到達できる確率を$P_{ij}^{(n)}$とします。(到達不可なら0)</li>
                <li>状態iについて、 $A_i = \{ n \in \text{自然数} \mid P_{ii}^{(n)} > 0 \}$ としたとき、任意のiについて、$A_i$の要素の最大公約数が1ならばマルコフ連鎖は非周期性を満たします。</li>
                <li>つまり、元に戻ってくるステップ数がある周期に縛られません。</li>
            </ul>
            
            <h3>使用する定理</h3>
            <ul>
                <li><strong>命題 1.7.1.</strong> 次の条件 (1)-(3) は同値です。
                    <ol>
                        <li>マルコフ連鎖はエルゴード的である。</li>
                        <li>マルコフ連鎖は斉時性を満たし、既約で、すべての状態は非周期的である。</li>
                        <li>マルコフ連鎖は斉時性を満たし、既約で、非周期的な状態が存在する。</li>
                    </ol>
                </li>
                <li><strong>定理 1.7.2.</strong> マルコフ連鎖がエルゴード的であるとき、定常分布 $\pi = \{\pi_j\}_{j \in S}$ が一意に存在し、十分なステップ数の後、遷移確率は定常分布に収束します。
                    $$ \lim_{n \to \infty} p_{ij}^{(n)} = \pi_j, \quad i,j \in S $$
                </li>
                <li>つまり、マルコフ連鎖が有限、既約、斉時性、非周期性を満たすならば定常分布は唯一に定まります。</li>
            </ul>

            <h3>焼きなまし法の定式化</h3>
            <ul>
                <li>ある温度Tの時、状態 $i$ から $j$ への遷移確率を $P_{ij} = G_{ij} \cdot A_{ij}(T)$ とモデル化します。</li>
                <li>$G_{ij}$ は状態 $j$ を候補として生成する確率、$A_{ij}(T)$ はその遷移を受理する確率です。</li>
                <li>受理確率は $A_{ij}(T) = \min(1, \exp((E_i - E_j)/T))$ と定義されます。ここで $E_i$ は状態 $i$ のコストです。</li>
                <li>この定式化は、解が改善すれば必ず遷移し、悪化する場合は温度が高いほど遷移しやすくなるという焼きなまし法のアイデアを反映しています。</li>
            </ul>

            <h3>ギブス分布と詳細つり合い条件</h3>
            <ul>
                <li>焼きなまし法の定常分布は、統計力学における<strong>ギブス分布</strong>で与えられます。
                    $$ \pi(s) = \frac{1}{Z(T)} \exp\left(-\frac{E(s)}{T}\right) $$
                    $$ Z(T) = \sum_{x \in \Omega} \exp\left(-\frac{E(x)}{T}\right) $$
                </li>
                <li>この分布が定常分布であることは、詳細つり合い条件 $\pi(i)P_{ij} = \pi(j)P_{ji}$ を満たすことから証明できます。</li>
            </ul>

            <h3>証明の概略</h3>
            <p>
                詳細つり合い条件と、受理確率 $A_{ij}(T)$ およびギブス分布 $\pi(s)$ の定義を組み合わせることで、以下の等式が導出されます。
                $$ \frac{A_{ij}(T)}{A_{ji}(T)} = \frac{\pi(j)}{\pi(i)} = \exp\left(-\frac{E(j)-E(i)}{T}\right) $$
                この関係は、$E(j) \le E(i)$（解の改善）と $E(j) > E(i)$（解の悪化）のどちらの場合でも成り立ちます。これにより、ギブス分布が確かに定常分布であることが示されます。
            </p>

            <h3>証明の成果</h3>
            <ul>
                <li>焼きなまし法をモデル化したマルコフ連鎖は、有限性、斉時性、既約性、非周期性を満たします。</li>
                <li>これにより、このマルコフ連鎖はエルゴード的であり、一意な定常分布（ギブス分布）を持つことが保証されます。</li>
            </ul>

            <h3>温度Tが0に漸近すると... (結論)</h3>
            <ul>
                <li>温度 $T$ を限りなくゼロに近づける ($T \to +0$) と、ギブス分布はエネルギーが最小となる状態、つまり最適解の集合 $\{s^*\}$ 上にのみ確率を持つ分布に収束します。
                    $$ \lim_{T \to +0} \pi(s) =
                    \begin{cases}
                        \frac{1}{|\{s^*\}|} & (\text{if } s \in \{s^*\}) \\
                        0 & (\text{if } s \notin \{s^*\})
                    </cases}
                    $$
                </li>
                <li>これは、温度Tを十分にゆっくり下げることで、焼きなまし法が最終的に最適解へ到達できることの理論的な根拠となります。</li>
                <li>$T_k = T_1 / \log k$ のような冷却スケジュールが、この収束を確率的に保証します。</li>
            </ul>

            <hr>
            <h3>参考文献</h3>
            <ul>
                <li><a href="https://qiita.com/take314/items/7eae18045e989d7eaf52" target="_blank" rel="noopener noreferrer">焼きなまし法(Simulated Annealing)について - Qiita</a></li>
                <li><a href="https://omedstu.jimdofree.com/2018/05/04/%E3%83%9E%E3%83%AB%E3%82%B3%E3%83%95%E9%80%A3%E9%8E%96-markov-chain/" target="_blank" rel="noopener noreferrer">マルコフ連鎖 (Markov Chain) - おめです。</a></li>
                <li><a href="https://note.com/dmaruyama/n/n1e144b6b8689" target="_blank" rel="noopener noreferrer">マルコフ連鎖と定常分布 - note</a></li>
                <li><a href="https://www.jstage.jst.go.jp/article/jjsai/9/3/9_365/_pdf" target="_blank" rel="noopener noreferrer">シミュレーテッドアニーリング ―基礎と最新技術― (PDF)</a></li>
                <li>講義資料: MCS.T312 「マルコフ解析」講義資料 マルコフ過程入門</li>
            </ul>
        </article>

        <a href="index.html" class="back-link">&laquo; 記事一覧に戻る</a>
    </main>

    <footer>
        <p>&copy; 2025 climaxのホームページ</p>
    </footer>
</body>
</html>